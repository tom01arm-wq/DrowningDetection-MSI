# ขอบเขตโครงงาน (Scope)

## วัตถุประสงค์
- พัฒนาระบบตรวจจับคนจมน้ำแบบเรียลไทม์โดยใช้เทคนิค **Multi-Object Tracking (MOT) และ ID Tagging** เพื่อติดตามพฤติกรรมรายบุคคลในสระว่ายน้ำ
- ลดทรัพยากรการประมวลผลและปัญหาการตรวจจับผิดพลาดเมื่อร่างกายถูกน้ำบดบัง (Occlusion)

## ขอบเขตการทำงาน
- ใช้กล้องวิดีโอ (Webcam/RTSP) เพื่อรับภาพจากสระว่ายน้ำแบบเรียลไทม์
- ใช้โมเดล **Object Detection (best.pt)** ที่เทรนมาเฉพาะสำหรับตรวจจับคนในสระว่ายน้ำ (drowning/swimming/person)
- ใช้ **YOLO Tracking** กำหนด **Tracking ID (ID1, ID2, ...)** ให้แต่ละบุคคลและรักษา ID คงที่ข้ามเฟรม
- วิเคราะห์พฤติกรรมรายบุคคลจาก **Zero Velocity** และ **Time Threshold** เพื่อตรวจจับภาวะจมน้ำแบบ Passive Drowning
- ส่งการแจ้งเตือนไปยัง Telegram พร้อมรูปภาพและ/หรือวิดีโอคลิปสั้นเมื่อตรวจพบความเสี่ยง
- รองรับการแจ้งเตือนเมื่อบุคคลที่เคยถูกระบุว่าเสี่ยง “หายไปจากกล้อง” นานเกินเกณฑ์

## นอกขอบเขต
- ไม่ใช้ Pose Estimation ในการวิเคราะห์ท่าทางตะเกียกตะกาย (เพื่อลดภาระประมวลผล)
- ไม่รองรับการตรวจจับในสภาพแวดล้อมที่ซับซ้อน (เช่น กลางคืน, สภาพอากาศเลวร้าย)
- ไม่รับประกันความแม่นยำเมื่อมีการบดบังของวัตถุอย่างรุนแรง (เช่น คนซ้อนกันมากกว่า 2 คนในพื้นที่เดียวกัน)

---

# หลักการทำงาน (Methodology)

## ภาพรวมระบบ
ระบบประกอบด้วย 3 ส่วนหลัก:
1. **Object Detection & Tracking** (YOLO + MOT) – ตรวจจับและติดตามบุคคลในภาพ
2. **Behavior Analysis** – วิเคราะห์ Zero Velocity และ Time Threshold
3. **Alert & Notification** – ส่งการแจ้งเตือนผ่าน Telegram

## 1. Object Detection & Tracking (MOT + ID Tagging)
- ใช้โมเดล YOLO (best.pt) ที่เทรนมาเฉพาะสำหรับตรวจจับคนในสระว่ายน้ำ
- ใช้ `model.track(..., persist=True)` เพื่อให้ได้ **Tracking ID** คงที่ข้ามเฟรม (ID1, ID2, …)
- แยกประเภทการตรวจจับเป็น:
  - **drowning** – บ่งชี้ว่าบุคคลอยู่ในภาวะเสี่ยง
  - **swimming** – บ่งชี้ว่าบุคคลกำลังว่ายน้ำปกติ
  - **person** – บุคคลทั่วไป (ถ้ามีในโมเดล)

## 2. นิยามการจมน้ำใหม่ (Passive Drowning)
ระบบกำหนดให้การจมน้ำคือภาวะที่ระบบตรวจพบว่าบุคคล (Tracking ID) มีลักษณะดังนี้:
- **Zero Velocity** – ไม่มีการเคลื่อนที่ของกล่องกรอบ (Bounding Box) ในช่วงเวลาหนึ่ง
- **Time Threshold** – อยู่ในภาวะ Zero Velocity เป็นระยะเวลานานผิดปกติ (เช่น > 3–5 วินาที)
- **Location** – ตำแหน่งอยู่ในบริเวณก้นสระหรือพื้นที่ที่มีความเสี่ยง (ถ้ามีข้อมูลพื้นที่)
- **Alert Trigger** – เมื่อตรงตามเงื่อนไขข้างต้น จะถูกระบุว่าเป็น **Passive Drowning** และแจ้งเตือน

## 3. การวิเคราะห์พฤติกรรมรายบุคคล
- รักษาประวัติ **ตำแหน่ง (x, y, w, h)** และ **เวลา** ของแต่ละ Tracking ID
- คำนวณ **Velocity** จากการเปลี่ยนแปลงตำแหน่งของ Bounding Box ระหว่างเฟรม
- ตรวจสอบ **Time Threshold** สำหรับ Zero Velocity และสถานะ “หายไปจากกล้อง” หลังเคยเสี่ยง
- ใช้ **IoU Matching** ระหว่าง Detection และ Pose (ถ้าเปิดใช้) เพื่อความแม่นยำในการผูก ID

## 4. การแจ้งเตือน (Alert System)
- เมื่อตรวจพบภาวะจมน้ำ จะส่งข้อความพร้อมรูปภาพและ/หรือวิดีโอคลิปสั้นไปยัง Telegram
- รองรับการแจ้งเตือนเมื่อบุคคลที่เคยเสี่ยง “หายไปจากกล้อง” นานเกินเกณฑ์ (Missing Person Alert)
- มีระบบ Cooldown เพื่อป้องกันการแจ้งเตือนซ้ำซ้อน

---

# เหตุผลที่เปลี่ยนจาก Pose Estimation มาเป็น MOT + ID Tagging

## 1. ลดทรัพยากรการประมวลผล (Computational Cost)
- Pose Estimation ต้องประมวลผลจุดพิกัด 17 จุดต่อคนต่อเฟรม → ใช้ CPU/GPU สูง
- MOT + ID Tagging ใช้เพียง Bounding Box และ Tracking ID → ประมวลผลเร็วกว่ามาก
- ทำให้ระบบทำงานได้แบบ **Real-time** บนฮาร์ดแวร์ทั่วไป

## 2. ลดปัญหาการตรวจจับผิดพลาดเมื่อร่างกายถูกน้ำบดบัง (Occlusion)
- Pose Estimation มักล้มเหลวเมื่อร่างกายถูกน้ำท่วมหรือมีฟองน้ำ
- MOT ใช้ Bounding Box ซึ่งทนต่อ Occlusion ได้ดีกว่า
- Tracking ID ช่วยรักษาตัวตนของบุคคลแม้มีการบดบังชั่วคราว

## 3. นิยามการจมน้ำแบบ Passive Drowning ตรงกับสถานการณ์จริง
- การจมน้ำแบบ Passive มักไม่มีการตะเกียกตะกาย แต่เป็นภาวะนิ่ง/จมอยู่ก้นสระ
- การใช้ Zero Velocity + Time Threshold ตรงกับลักษณะนี้มากกว่าการวิเคราะห์ท่าทาง
- ลด False Positive จากการว่ายน้ำท่าทางต่างๆ

## 4. ง่ายต่อการปรับใช้และบำรุงรักษา
- ไม่ต้องพึ่งข้อมูล Pose ที่ซับซ้อน
- ใช้โมเดล Detection ที่เทรนง่ายกว่า
- สามารถปรับ Threshold และ Logic ได้โดยตรง

---

# ผลลัพธ์ที่คาดหวัง
- ระบบตรวจจับคนจมน้ำแบบเรียลไทม์ที่ใช้ทรัพยากรต่ำ
- ความแม่นยำสูงในการตรวจจับ Passive Drowning
- ลดปัญหา False Positive และ False Negative จาก Occlusion
- การแจ้งเตือนที่รวดเร็วและชัดเจนผ่าน Telegram
